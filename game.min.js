window.onload=function(){function e(){p.text="Player: "+hero+"\nScore: "+A+"\nBest Player: "+_+"\nBest Score: "+E}function o(){(0==c.body.velocity.y||j>f)&&(f++,h=S.add.sprite(c.x,c.y-50,"powerbar"),h.width=0,u=S.add.tween(h).to({width:100},1e3,"Linear",!0),S.input.onDown.remove(o,this),S.input.onUp.add(t,this))}function t(){d=3*-h.width-100,h.destroy(),S.tweens.removeAll(),c.body.velocity.y=2*d,w=!0,u.stop(),S.input.onUp.remove(t,this),j>f&&S.input.onDown.add(o,this)}function a(){var e=0;m.forEach(function(o){e=Math.max(o.x,e)});var o=e+S.rnd.between(k,M);n(o)}function n(e){if(e<2*S.width){y++;var o=new Pole(S,e,S.rnd.between(380,480));S.add.existing(o),o.anchor.set(.5,0),m.add(o);var t=e+S.rnd.between(k,M);n(t)}}function i(){localStorage.setItem("topFlappyScore",Math.max(A,E))}function r(t,a){if(S.input.onDown.remove(o,this),t.body.touching.down){var n=t.x-a.x;Math.abs(n)>35?(t.body.velocity.x=2*n,t.body.velocity.y=-200):(f=0,S.input.onDown.add(o,this));var i=a.poleNumber-t.lastPole;i>0&&(A+=Math.pow(2,i),e(),t.lastPole=a.poleNumber,c.x=80),w&&(w=!1)}else b=!0,m.forEach(function(e){e.body.velocity.x=0})}function s(){S.state.start("Play"),A>E?(g.update({top:A,name:$.urlParam("name")},R),E=A,_=hero):console.log("false")}function l(){window.location.replace("http://game.wip.camp"),A>E?(g.update({top:A,name:$.urlParam("name")},R),E=A,_=hero):console.log("false")}var c,d,p,h,u,y,m,w,b,f,g=new Firebase("https://wippo-jump.firebaseio.com"),v=window.innerWidth,P=window.innerHeight,x=v/P,S=new Phaser.Game(Math.floor(720*x),720,Phaser.CANVAS),C=800,A=0,_=$.urlParam("bn"),E=$.urlParam("bscore"),k=120,M=250,j=1,D=function(e){};D.prototype={preload:function(){S.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,S.scale.setScreenSize(!0);var e="assets/img/wippo_game/wippo-"+$.urlParam("char")+".png";S.load.image("ninja",e),S.load.image("pole","pole.jpg"),S.load.image("powerbar","powerbar.png"),S.load.image("background","assets/img/bg_wipcamp.jpg"),S.load.spritesheet("button_re","assets/img/button_re.png",206,77),S.load.spritesheet("button_main","assets/img/button_main.png",206,77)},create:function(){g.once("value",function(e){e.forEach(function(e){console.log("The "+e.key()+" score is "+e.val()),"name"==e.key()&&(_=e.val(),_=decodeURIComponent(_)),"top"==e.key()&&(dummyScore=e.val())}),E=dummyScore}),w=!1,b=!1,A=0,y=0,f=0;var o=S.add.tileSprite(0,0,1e3,600,"background");if(S.width<1440){var t=(1440-S.width)/2*-1;o.x=t,o.width=1440}else o.x=0,o.width=S.width;o.y=0,o.height=S.height,o.smoothed=!1,m=S.add.group(),hero=$.urlParam("name"),hero=decodeURIComponent(hero),p=S.add.text(S.width-300,20,"-",{font:"bold 20px Helvetica",fill:"#ffffff"}),console.log(_),_=decodeURIComponent(_),e(),S.stage.backgroundColor="#87CEEB",S.physics.startSystem(Phaser.Physics.ARCADE),c=S.add.sprite(80,0,"ninja"),c.anchor.set(.5),c.lastPole=1,S.physics.arcade.enable(c),c.body.gravity.y=C,n(80)},update:function(){S.physics.arcade.collide(c,m,r),c.y>S.height&&(i(),button=S.add.button(S.world.centerX-230,S.world.centerY,"button_re",s,this,2,1,0),button=S.add.button(S.world.centerX+15,S.world.centerY,"button_main",l,this,2,1,0),S.stage.backgroundColor="rgba(255, 255, 255, 0.5)")}},S.state.add("Play",D),S.state.start("Play"),Pole=function(e,o,t){Phaser.Sprite.call(this,e,o,t,"pole"),e.physics.enable(this,Phaser.Physics.ARCADE),this.body.immovable=!0,this.poleNumber=y},Pole.prototype=Object.create(Phaser.Sprite.prototype),Pole.prototype.constructor=Pole,Pole.prototype.update=function(){w&&!b?this.body.velocity.x=d:this.body.velocity.x=0,this.x<-this.width&&(this.destroy(),a())},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var R=function(e){e?console.log("Synchronization failed"):console.log("Synchronization succeeded")}},$.urlParam=function(e){var o=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return o[1]||0};