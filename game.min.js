window.onload=function(){function e(){p.text="Player: "+hero+"\nScore: "+_+"\nBest Player: "+E+"\nBest Score: "+j}function o(){(0==l.body.velocity.y||D>f)&&(f++,h=C.add.sprite(l.x,l.y-50,"powerbar"),h.width=0,u=C.add.tween(h).to({width:100},1e3,"Linear",!0),C.input.onDown.remove(o,this),C.input.onUp.add(t,this))}function t(){d=3*-h.width-100,h.destroy(),C.tweens.removeAll(),l.body.velocity.y=2*d,w=!0,u.stop(),C.input.onUp.remove(t,this),D>f&&C.input.onDown.add(o,this)}function a(){var e=0;y.forEach(function(o){e=Math.max(o.x,e)});var o=e+C.rnd.between(k,M);n(o)}function n(e){if(e<2*C.width){m++;var o=new Pole(C,e,C.rnd.between(380,480));C.add.existing(o),o.anchor.set(.5,0),y.add(o);var t=e+C.rnd.between(k,M);n(t)}}function i(){localStorage.setItem("topFlappyScore",Math.max(_,j))}function r(t,a){if(C.input.onDown.remove(o,this),t.body.touching.down){var n=t.x-a.x;Math.abs(n)>35?(t.body.velocity.x=2*n,t.body.velocity.y=-200):(f=0,C.input.onDown.add(o,this));var i=a.poleNumber-t.lastPole;i>0&&(_+=Math.pow(2,i),e(),t.lastPole=a.poleNumber,l.x=80),w&&(w=!1)}else b=!0,y.forEach(function(e){e.body.velocity.x=0})}function s(){C.state.start("Play"),_>j?(g.update({top:_,name:$.urlParam("name")},U),j=_,E=hero):console.log("false"),v.push({name:hero,score:_})}function c(){window.location.replace("http://game.wip.camp"),_>j?(g.update({top:_,name:$.urlParam("name")},U),j=_,E=hero):console.log("false"),v.push({name:hero,score:_})}var l,d,p,h,u,m,y,w,b,f,g=new Firebase("https://wippo-jump.firebaseio.com"),v=new Firebase("https://wippo-jump.firebaseio.com/history"),P=window.innerWidth,x=window.innerHeight,S=P/x,C=new Phaser.Game(Math.floor(720*S),720,Phaser.CANVAS),A=800,_=0,E=$.urlParam("bn"),j=$.urlParam("bscore"),k=120,M=250,D=1,R=function(e){};R.prototype={preload:function(){C.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,C.scale.setScreenSize(!0);var e="assets/img/wippo_game/wippo-"+$.urlParam("char")+".png";C.load.image("ninja",e),C.load.image("pole","pole.jpg"),C.load.image("powerbar","powerbar.png"),C.load.image("background","assets/img/bg_wipcamp.jpg"),C.load.spritesheet("button_re","assets/img/button_re.png",206,77),C.load.spritesheet("button_main","assets/img/button_main.png",206,77)},create:function(){g.once("value",function(e){e.forEach(function(e){console.log("The "+e.key()+" score is "+e.val()),"name"==e.key()&&(E=e.val(),E=decodeURIComponent(E)),"top"==e.key()&&(dummyScore=e.val())}),j=dummyScore}),w=!1,b=!1,_=0,m=0,f=0;var o=C.add.tileSprite(0,0,1e3,600,"background");if(C.width<1440){var t=(1440-C.width)/2*-1;o.x=t,o.width=1440}else o.x=0,o.width=C.width;o.y=0,o.height=C.height,o.smoothed=!1,y=C.add.group(),hero=$.urlParam("name"),hero=decodeURIComponent(hero),p=C.add.text(C.width-300,20,"-",{font:"bold 20px Helvetica",fill:"#ffffff"}),console.log(E),E=decodeURIComponent(E),e(),C.stage.backgroundColor="#87CEEB",C.physics.startSystem(Phaser.Physics.ARCADE),l=C.add.sprite(80,0,"ninja"),l.anchor.set(.5),l.lastPole=1,C.physics.arcade.enable(l),l.body.gravity.y=A,n(80)},update:function(){C.physics.arcade.collide(l,y,r),l.y>C.height&&(i(),button=C.add.button(C.world.centerX-230,C.world.centerY,"button_re",s,this,2,1,0),button=C.add.button(C.world.centerX+15,C.world.centerY,"button_main",c,this,2,1,0),C.stage.backgroundColor="rgba(255, 255, 255, 0.5)")}},C.state.add("Play",R),C.state.start("Play"),Pole=function(e,o,t){Phaser.Sprite.call(this,e,o,t,"pole"),e.physics.enable(this,Phaser.Physics.ARCADE),this.body.immovable=!0,this.poleNumber=m},Pole.prototype=Object.create(Phaser.Sprite.prototype),Pole.prototype.constructor=Pole,Pole.prototype.update=function(){w&&!b?this.body.velocity.x=d:this.body.velocity.x=0,this.x<-this.width&&(this.destroy(),a())},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var U=function(e){e?console.log("Synchronization failed"):console.log("Synchronization succeeded")}},$.urlParam=function(e){var o=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return o[1]||0};